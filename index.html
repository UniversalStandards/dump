<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Block Extractor</title>
    <meta name="description" content="Extract and organize code blocks from conversation dumps, chat logs, and text files with our free web-based tool.">
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üíª</text></svg>">
    <link rel="stylesheet" href="styles.css">
    <!-- Font Awesome icons will be replaced with simple Unicode symbols for GitHub Pages compatibility -->
</head>
<body>
    <div class="container">
        <header>
            <h1>üíª Code Block Extractor</h1>
            <p>Extract and organize code blocks from conversation dumps, chat logs, and text files</p>
        </header>

        <main>
            <!-- File Upload Section -->
            <section class="upload-section">
                <div class="upload-area" id="uploadArea">
                    <div class="upload-content">
                        <i class="upload-icon">‚òÅÔ∏è</i>
                        <h3>Drop your files here or click to browse</h3>
                        <p>Supports .md, .txt, and other text files</p>
                        <input type="file" id="fileInput" multiple accept=".md,.txt,.log,.rtf">
                        <button type="button" class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                            üìÅ Choose Files
                        </button>
                    </div>
                </div>
            </section>

            <!-- Processing Options -->
            <section class="options-section" id="optionsSection" style="display: none;">
                <h3>‚öôÔ∏è Processing Options</h3>
                <div class="options-grid">
                    <div class="option-group">
                        <label for="outputName">Output Folder Name:</label>
                        <input type="text" id="outputName" value="extracted_code" placeholder="extracted_code">
                    </div>
                    <div class="option-group">
                        <label>
                            <input type="checkbox" id="verboseMode" checked>
                            <span class="checkmark"></span>
                            Verbose processing
                        </label>
                    </div>
                    <div class="option-group">
                        <label>
                            <input type="checkbox" id="includeMetadata" checked>
                            <span class="checkmark"></span>
                            Include metadata files
                        </label>
                    </div>
                </div>
            </section>

            <!-- File List -->
            <section class="file-list-section" id="fileListSection" style="display: none;">
                <h3>üìã Selected Files</h3>
                <div id="fileList" class="file-list"></div>
                <div class="action-buttons">
                    <button class="btn btn-success" id="processBtn">
                        ‚ñ∂Ô∏è Extract Code Blocks
                    </button>
                    <button class="btn btn-secondary" id="clearBtn">
                        üóëÔ∏è Clear All
                    </button>
                </div>
            </section>

            <!-- Progress Section -->
            <section class="progress-section" id="progressSection" style="display: none;">
                <h3>‚è≥ Processing...</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div id="progressText">Initializing...</div>
                <div id="progressDetails"></div>
            </section>

            <!-- Results Section -->
            <section class="results-section" id="resultsSection" style="display: none;">
                <h3>‚úÖ Extraction Results</h3>
                <div id="extractionStats" class="stats-grid"></div>
                <div id="extractedFiles" class="extracted-files"></div>
                <div class="download-section">
                    <button class="btn btn-download" id="downloadAllBtn">
                        üíæ Download All as ZIP
                    </button>
                    <button class="btn btn-secondary" id="newExtractionBtn">
                        ‚ûï New Extraction
                    </button>
                </div>
                <div class="storage-section">
                    <button class="btn btn-info" id="loadStoredBtn" style="display: none;">
                        üìÇ Load Previous Results
                    </button>
                    <button class="btn btn-warning" id="clearStorageBtn" style="display: none;">
                        üóëÔ∏è Clear Storage
                    </button>
                </div>
            </section>

            <!-- Error Section -->
            <section class="error-section" id="errorSection" style="display: none;">
                <h3>‚ö†Ô∏è Error</h3>
                <div id="errorMessage"></div>
                <button class="btn btn-secondary" id="retryBtn">
                    üîÑ Try Again
                </button>
            </section>
        </main>

            <!-- Footer -->
        <footer>
            <p>
                ‚ÑπÔ∏è 
                Supports Python, JavaScript, HTML, CSS, SQL, YAML, JSON, Dockerfile, Bash, Java, C/C++, and more
            </p>
            <div class="help-links">
                <button class="help-btn" onclick="app.showHelp()">
                    ‚ùì Help
                </button>
                <button class="help-btn" onclick="app.loadDemo()">
                    üöÄ Try Demo
                </button>
            </div>
            <div class="github-link">
                <a href="https://github.com/UniversalStandards/dump" target="_blank">
                    üåê View on GitHub
                </a>
            </div>
        </footer>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ùì How to Use Code Block Extractor</h2>
                <button class="modal-close" onclick="app.closeHelp()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="help-section">
                    <h3>üì§ Step 1: Upload Files</h3>
                    <p>Drag and drop your conversation files, or click "Choose Files" to select them. Supported formats:</p>
                    <ul>
                        <li><strong>.md</strong> - Markdown files</li>
                        <li><strong>.txt</strong> - Text files</li>
                        <li><strong>.log</strong> - Log files</li>
                        <li><strong>.rtf</strong> - Rich text files</li>
                    </ul>
                </div>

                <div class="help-section">
                    <h3>‚öôÔ∏è Step 2: Configure Options</h3>
                    <p>Customize your extraction:</p>
                    <ul>
                        <li><strong>Output Folder Name</strong> - Name for your extracted code collection</li>
                        <li><strong>Verbose Processing</strong> - See detailed extraction progress</li>
                        <li><strong>Include Metadata</strong> - Add JSON files with extraction details</li>
                    </ul>
                </div>

                <div class="help-section">
                    <h3>‚ñ∂Ô∏è Step 3: Extract Code</h3>
                    <p>Click "Extract Code Blocks" to start processing. The tool will:</p>
                    <ul>
                        <li>Find fenced code blocks (```language)</li>
                        <li>Detect indented code (4+ spaces)</li>
                        <li>Automatically identify programming languages</li>
                        <li>Organize code by conversation topics</li>
                    </ul>
                </div>

                <div class="help-section">
                    <h3>üíæ Step 4: Download Results</h3>
                    <p>Get your organized code files:</p>
                    <ul>
                        <li><strong>Download All as ZIP</strong> - Complete archive with folder structure</li>
                        <li><strong>Individual Files</strong> - Download specific code files one by one</li>
                    </ul>
                </div>

                <div class="help-section">
                    <h3>üíª Supported Languages</h3>
                    <div class="language-grid">
                        <span class="language-tag">Python</span>
                        <span class="language-tag">JavaScript</span>
                        <span class="language-tag">HTML</span>
                        <span class="language-tag">CSS</span>
                        <span class="language-tag">SQL</span>
                        <span class="language-tag">Java</span>
                        <span class="language-tag">C/C++</span>
                        <span class="language-tag">Bash</span>
                        <span class="language-tag">JSON</span>
                        <span class="language-tag">YAML</span>
                        <span class="language-tag">Dockerfile</span>
                        <span class="language-tag">XML</span>
                    </div>
                </div>

                <div class="help-section">
                    <h3>üîí Privacy & Security</h3>
                    <p>Your files are processed entirely in your browser - nothing is uploaded to any server. All processing happens client-side for maximum privacy and security.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="loading-content">
            <i class="loading-icon">‚öôÔ∏è</i>
            <p>Processing your files...</p>
        </div>
    </div>

    <!-- JSZip will be loaded with fallback handling -->
    <script>
        // Fallback for JSZip if CDN fails
        window.JSZipLoaded = false;
        
        function loadJSZipFallback() {
            if (!window.JSZip) {
                console.warn('JSZip not available from CDN, using fallback download method');
                // We'll implement a simple download fallback
                window.JSZip = {
                    // Mock JSZip with basic functionality
                    folder: function(name) {
                        return {
                            file: function(filename, content) {
                                // Store for fallback download
                                if (!window.fallbackFiles) window.fallbackFiles = {};
                                window.fallbackFiles[name + '/' + filename] = content;
                            }
                        };
                    },
                    file: function(filename, content) {
                        if (!window.fallbackFiles) window.fallbackFiles = {};
                        window.fallbackFiles[filename] = content;
                    },
                    generateAsync: function() {
                        return Promise.resolve(new Blob(['Fallback: Individual file downloads available'], { type: 'text/plain' }));
                    }
                };
            }
            window.JSZipLoaded = true;
        }
        
        // Try to load JSZip from CDN, fallback on error
        var script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js';
        script.onload = function() {
            window.JSZipLoaded = true;
        };
        script.onerror = function() {
            loadJSZipFallback();
        };
        document.head.appendChild(script);
        
        // Ensure JSZip is loaded before app initialization
        setTimeout(function() {
            if (!window.JSZipLoaded) {
                loadJSZipFallback();
            }
        }, 3000);
    </script>
    <script src="js/code-extractor.js"></script>
    <script src="js/app.js"></script>
</body>
</html>